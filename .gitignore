# Uncomment these types if you want even more clean repository. But be careful.
# It can make harm to an existing project source. Read explanations below.
#
# Resource files are binaries containing manifest, project icon and version info.
# They can not be viewed as text or compared by diff-tools. Consider replacing them with .rc files.
#*.res
#
# Type library file (binary). In old Delphi versions it should be stored.
# Since Delphi 2009 it is produced from .ridl file and can safely be ignored.
#*.tlb
#
# Diagram Portfolio file. Used by the diagram editor up to Delphi 7.
# Uncomment this if you are not using diagrams or use newer Delphi version.
#*.ddp
#
# Visual LiveBindings file. Added in Delphi XE2.
# Uncomment this if you are not using LiveBindings Designer.
#*.vlb
#
# Deployment Manager configuration file for your project. Added in Delphi XE2.
# Uncomment this if it is not mobile development and you do not use remote debug feature.
#*.deployproj
#

# Delphi compiler-generated binaries (safe to delete)
*.exe
*.dll
*.bpl
*.bpi
*.dcp
*.so
*.apk
*.drc
*.map
*.dres
*.rsm
*.tds
*.dcu
*.lib

# Delphi autogenerated files (duplicated info)
*.cfg
*Resource.rc

# Delphi local files (user-specific info)
*.local
*.identcache
*.projdata
*.tvsconfig
*.dsk

# Delphi history and backups
__history/
*.~*

# Castalia statistics file
*.stat
unit ss3p;

interface

uses
  Windows, Messages, SysUtils, Variants, Classes, Graphics, Controls, Forms,
  Dialogs, StdCtrls, DB, DBTables, ExtCtrls, ADODB, ComCtrls, Grids;

type
  TForm1 = class(TForm)
    Label6: TLabel;
    Label7: TLabel;
    Button6: TButton;
    Query1: TQuery;
    ADOConnection1: TADOConnection;
    ADOTRfc: TADOTable;
    ADOTCel: TADOTable;
    ADOTMesCelCcl: TADOTable;
    ADOQuery1: TADOQuery;
    Label10: TLabel;
    Label11: TLabel;
    ADOQuery2: TADOQuery;
    Label1: TLabel;
    ADOTMesCelCcr: TADOTable;
    ADOTMesFlt: TADOTable;
    ADOTMesMde: TADOTable;
    ADOTMesSfl: TADOTable;
    ADOTMesT: TADOTable;
    ADOTMesTbf: TADOTable;
    Label2: TLabel;
    Edit1: TEdit;
    ProgressBar1: TProgressBar;
    StringGrid1: TStringGrid;
    Button1: TButton;
    Edit2: TEdit;
    Edit3: TEdit;
    Button2: TButton;
    Button3: TButton;
    Button4: TButton;
    Button5: TButton;
    Timer1: TTimer;
    RadioGroup1: TRadioGroup;
    Label3: TLabel;
    Button7: TButton;
    procedure FormShow(Sender: TObject);
    procedure Button6Click(Sender: TObject);
    procedure Button1Click(Sender: TObject);
    procedure Button2Click(Sender: TObject);
    procedure Button3Click(Sender: TObject);
    procedure Button5Click(Sender: TObject);
    procedure Button4Click(Sender: TObject);
    procedure Timer1Timer(Sender: TObject);
    procedure Button7Click(Sender: TObject);

  private
    { Private declarations }
  public
    { Public declarations }
  end;

var
  Form1: TForm1;
  a:array[1..7] of integer;

implementation

{$R *.dfm}

procedure TForm1.FormShow(Sender: TObject);
var
  i:integer;
begin
  a[7]:=STRTOINT(Edit1.text);   // StId                                          //2011.03.23 修正
  for i := 1 to 6 do a[i]:=0;
  if a[7]=1 then
    begin
//      a[1]:=34062;       // Mes.Id     //T1 2010.09.27 2010.11.18  ACCESS毀損 接續寫入資料庫
//      a[2]:=4331;        // MesCel.Id
//      a[3]:=26;          // MesRfc.Id
//      a[4]:=9;           // MesMde.Id
//      a[5]:=2;           // MesFlt.Id
//      a[6]:=2;           // MesTbf.Id
//      a[1]:=64635;       // Mes.Id     //T1 2011.11.24  ACCESS毀損 接續寫入資料庫
//      a[2]:=7841;        // MesCel.Id
//      a[3]:=88;          // MesRfc.Id
//      a[4]:=15;           // MesMde.Id
//      a[5]:=3;           // MesFlt.Id
//      a[6]:=3;           // MesTbf.Id
//      a[1]:=65195;       // Mes.Id     //T1 2011.11.26  ACCESS毀損 接續寫入資料庫
//      a[2]:=7855;        // MesCel.Id
//      a[3]:=89;          // MesRfc.Id
//      a[4]:=16;           // MesMde.Id
//      a[5]:=4;           // MesFlt.Id
//      a[6]:=3;           // MesTbf.Id
//      a[1]:=93019;       // Mes.Id       //T1  2012.03.09 ACCESS毀損 接續寫入資料庫
//      a[2]:=10554;        // MesCel.Id
//      a[3]:=90;          // MesRfc.Id
//      a[4]:=19;           // MesMde.Id
//      a[5]:=5;           // MesFlt.Id
//      a[6]:=3;           // MesTbf.Id
//      a[1]:=119130;       // Mes.Id       //T1  2012.04.30 ACCESS毀損 接續寫入資料庫
//      a[2]:=12872;        // MesCel.Id
//      a[3]:=92;          // MesRfc.Id
//      a[4]:=26;           // MesMde.Id
//      a[5]:=6;           // MesFlt.Id
//      a[6]:=3;           // MesTbf.Id
//      a[1]:=147628;       // Mes.Id       //T1  2012.06.26 ACCESS毀損 接續寫入資料庫
//      a[2]:=15594;        // MesCel.Id
//      a[3]:=93;          // MesRfc.Id
//      a[4]:=33;           // MesMde.Id
//      a[5]:=7;           // MesFlt.Id
//      a[6]:=3;           // MesTbf.Id
//      a[1]:=171981;       // Mes.Id       //T1  2012.10.25 ACCESS毀損 接續寫入資料庫
//      a[2]:=19345;        // MesCel.Id
//      a[3]:=94;          // MesRfc.Id
//      a[4]:=70;           // MesMde.Id
//      a[5]:=8;           // MesFlt.Id
//      a[6]:=3;           // MesTbf.Id
//      a[1]:=195434;       // Mes.Id       //T1  2013.1.9 ACCESS毀損 接續寫入資料庫
//      a[2]:=22176;        // MesCel.Id
//      a[3]:=95;          // MesRfc.Id
//      a[4]:=73;           // MesMde.Id
//      a[5]:=9;           // MesFlt.Id
//      a[6]:=3;           // MesTbf.Id
//      a[1]:=217153;       // Mes.Id       //T1  2013.4.12 ACCESS毀損 接續寫入資料庫
//      a[2]:=26254;        // MesCel.Id
//      a[3]:=106;          // MesRfc.Id
//      a[4]:=75;           // MesMde.Id
//      a[5]:=10;           // MesFlt.Id
//      a[6]:=3;           // MesTbf.Id
//      a[1]:=236726;       // Mes.Id        //T1  2013.5.23 ACCESS毀損 接續寫入資料庫
//      a[2]:=28393;        // MesCel.Id
//      a[3]:=113;          // MesRfc.Id
//      a[4]:=76;           // MesMde.Id
//      a[5]:=11;           // MesFlt.Id
//      a[6]:=3;            // MesTbf.Id
//      a[1]:=256953;       // Mes.Id        //T1  2013.6.23 ACCESS毀損 接續寫入資料庫
//      a[2]:=31070;        // MesCel.Id
//      a[3]:=116;          // MesRfc.Id
//      a[4]:=77;           // MesMde.Id
//      a[5]:=12;           // MesFlt.Id
//      a[6]:=3;            // MesTbf.Id
//      a[1]:=276350;       // Mes.Id        //T1  2013.8.19 ACCESS毀損 接續寫入資料庫
//      a[2]:=33783;        // MesCel.Id
//      a[3]:=121;          // MesRfc.Id
//      a[4]:=82;           // MesMde.Id
//      a[5]:=14;           // MesFlt.Id
//      a[6]:=3;            // MesTbf.Id
//      a[1]:=293756;       // Mes.Id        //T1  2013.7.26 ACCESS毀損 接續寫入資料庫
//      a[2]:=35855;        // MesCel.Id
//      a[3]:=125;          // MesRfc.Id
//      a[4]:=84;           // MesMde.Id
//      a[5]:=16;           // MesFlt.Id
//      a[6]:=3;            // MesTbf.Id
//      a[1]:=294612;       // Mes.Id        //T1  2013.8.19 ACCESS毀損 接續寫入資料庫
//      a[2]:=36043;        // MesCel.Id
//      a[3]:=127;          // MesRfc.Id
//      a[4]:=85;           // MesMde.Id
//      a[5]:=17;           // MesFlt.Id
//      a[6]:=3;            // MesTbf.Id
//      a[1]:=314662;       // Mes.Id        //T1  2013.9.24 ACCESS毀損 接續寫入資料庫
//      a[2]:=38540;        // MesCel.Id
//      a[3]:=129;          // MesRfc.Id
//      a[4]:=86;           // MesMde.Id
//      a[5]:=18;           // MesFlt.Id
//      a[6]:=3;            // MesTbf.Id
//      a[1]:=319259;       // Mes.Id        //T1  2013.10.01 ACCESS毀損 接續寫入資料庫
//      a[2]:=39341;        // MesCel.Id
//      a[3]:=131;          // MesRfc.Id
//      a[4]:=87;           // MesMde.Id
//      a[5]:=19;           // MesFlt.Id
//      a[6]:=3;            // MesTbf.Id
//      a[1]:=337876;       // Mes.Id        //T1  2013.11.01 ACCESS毀損 接續寫入資料庫
//      a[2]:=41946;        // MesCel.Id
//      a[3]:=132;          // MesRfc.Id
//      a[4]:=90;           // MesMde.Id
//      a[5]:=20;           // MesFlt.Id
//      a[6]:=3;            // MesTbf.Id
//
//      a[1]:=358240;       // Mes.Id        //T1  2014.01.09 ACCESS毀損 接續寫入資料庫
//      a[2]:=46538;        // MesCel.Id
//      a[3]:=136;          // MesRfc.Id
//      a[4]:=95;           // MesMde.Id
//      a[5]:=21;           // MesFlt.Id
//      a[6]:=3;            // MesTbf.Id
//      a[1]:=379007;       // Mes.Id        //T1  2014.03.12 ACCESS毀損 接續寫入資料庫
//      a[2]:=50477;        // MesCel.Id
//      a[3]:=144;          // MesRfc.Id
//      a[4]:=98;           // MesMde.Id
//      a[5]:=22;           // MesFlt.Id
//      a[6]:=3;            // MesTbf.Id
//      a[1]:=387817;       // Mes.Id        //T1  2014.04.17 ACCESS毀損 接續寫入資料庫
//      a[2]:=51641;        // MesCel.Id
//      a[3]:=145;          // MesRfc.Id
//      a[4]:=100;          // MesMde.Id
//      a[5]:=23;           // MesFlt.Id
//      a[6]:=3;            // MesTbf.Id

      a[1]:=399594;       // Mes.Id        //T1  2014.07.21 ACCESS毀損 接續寫入資料庫
      a[2]:=53489;        // MesCel.Id
      a[3]:=146;          // MesRfc.Id
      a[4]:=101;          // MesMde.Id
      a[5]:=24;           // MesFlt.Id
      a[6]:=3;            // MesTbf.Id

    end;
  if a[7]=2 then
    begin
//      a[1]:=96884;       // Mes.Id    //T2  2010.11.12 ACCESS毀損 接續寫入資料庫
//      a[2]:=12362;       // MesCel.Id
//      a[3]:=616;         // MesRfc.Id
//      a[4]:=15;          // MesMde.Id
//      a[5]:=5;           // MesFlt.Id
//      a[6]:=5;           // MesTbf.Id
//      a[1]:=119232;      // Mes.Id    //T2 2011.03.21 ACCESS毀損 接續寫入資料庫
//      a[2]:=14343;       // MesCel.Id
//      a[3]:=633;         // MesRfc.Id
//      a[4]:=21;          // MesMde.Id
//      a[5]:=6;           // MesFlt.Id
//      a[6]:=6;           // MesTbf.Id
//      a[1]:=142640;      // Mes.Id     //T2  2011.11.01 ACCESS毀損 接續寫入資料庫
//      a[2]:=15574;       // MesCel.Id
//      a[3]:=648;         // MesRfc.Id
//      a[4]:=35;          // MesMde.Id
//      a[5]:=7;           // MesFlt.Id
//      a[6]:=6;           // MesTbf.Id
//      a[1]:=194934;      // Mes.Id       //T2  2012.3.24 ACCESS毀損 接續寫入資料庫
//      a[2]:=25134;       // MesCel.Id
//      a[3]:=663;         // MesRfc.Id
//      a[4]:=38;          // MesMde.Id
//      a[5]:=10;          // MesFlt.Id
//      a[6]:=6;           // MesTbf.Id
//      a[1]:=214918;      // Mes.Id       //T2  2013.12.28 ACCESS毀損 接續寫入資料庫
//      a[2]:=27447;       // MesCel.Id
//     a[3]:=667;          // MesRfc.Id
//     a[4]:=41;           // MesMde.Id
//     a[5]:=11;           // MesFlt.Id
//     a[6]:=6;            // MesTbf.Id

      a[1]:=234885;        // Mes.Id       //T2  2014.04.04 ACCESS毀損 接續寫入資料庫
      a[2]:=29455;         // MesCel.Id
      a[3]:=669;           // MesRfc.Id
      a[4]:=42;            // MesMde.Id
      a[5]:=12;            // MesFlt.Id
      a[6]:=6;             // MesTbf.Id

    end;

  Button7.Click;                                                                 // check

  ADOQuery1.close;
  ADOQuery1.SQL.Clear;                                                           // 2 check  MesCel 最後一筆Id
  ADOQuery1.SQL.add('select Id');
  ADOQuery1.sql.add('from MesCel');
  ADOQuery1.sql.add('where StId=:StId');
  ADOQuery1.sql.add('and Id>=:Id');
  ADOQuery1.sql.add('order by Id');
  ADOQuery1.Parameters.parambyname('StId').VALUE:=a[7];
  ADOQuery1.Parameters.parambyname('Id').VALUE:=a[2];
  ADOQuery1.open;
  ADOQuery1.last;
  StringGrid1.Cells[1,2]:=ADOQuery1.Fields[0].asstring;

  ADOQuery1.close;                                                                // 3 check  MesRfc 最後一筆Id
  ADOQuery1.SQL.Clear;
  ADOQuery1.SQL.add('select Id');
  ADOQuery1.sql.add('from MesRfc');
  ADOQuery1.sql.add('where StId=:StId');
  ADOQuery1.sql.add('and Id>=:Id');
  ADOQuery1.sql.add('order by Id');
  ADOQuery1.Parameters.parambyname('StId').VALUE:=a[7];
  ADOQuery1.Parameters.parambyname('Id').VALUE:=a[3];
  ADOQuery1.open;
  ADOQuery1.last;
  StringGrid1.Cells[1,3]:=ADOQuery1.Fields[0].asstring;

  ADOQuery1.close;                                                                // 4 check  MesMde 最後一筆Id
  ADOQuery1.SQL.Clear;
  ADOQuery1.SQL.add('select Id');
  ADOQuery1.sql.add('from MesMde');
  ADOQuery1.sql.add('where StId=:StId');
  ADOQuery1.sql.add('and Id>=:Id');
  ADOQuery1.sql.add('order by Id');
  ADOQuery1.Parameters.parambyname('StId').VALUE:=a[7];
  ADOQuery1.Parameters.parambyname('Id').VALUE:=a[4];
  ADOQuery1.open;
  ADOQuery1.last;
  StringGrid1.Cells[1,4]:=ADOQuery1.Fields[0].asstring;

  ADOQuery1.close;                                                                // 5 check  MesFlt 最後一筆Id
  ADOQuery1.SQL.Clear;
  ADOQuery1.SQL.add('select Id');
  ADOQuery1.sql.add('from MesFlt');
  ADOQuery1.sql.add('where StId=:StId');
  ADOQuery1.sql.add('and Id>=:Id');
  ADOQuery1.sql.add('order by Id');
  ADOQuery1.Parameters.parambyname('StId').VALUE:=a[7];
  ADOQuery1.Parameters.parambyname('Id').VALUE:=a[5];
  ADOQuery1.open;
  ADOQuery1.last;
  StringGrid1.Cells[1,5]:=ADOQuery1.Fields[0].asstring;

  ADOQuery1.close;                                                                // 6  check  MesTbf 最後一筆Id
  ADOQuery1.SQL.Clear;
  ADOQuery1.SQL.add('select Id');
  ADOQuery1.sql.add('from MesTbf');
  ADOQuery1.sql.add('where StId=:StId');
  ADOQuery1.sql.add('and Id>=:Id');
  ADOQuery1.sql.add('order by Id');
  ADOQuery1.Parameters.parambyname('StId').VALUE:=a[7];
  ADOQuery1.Parameters.parambyname('Id').VALUE:=a[6];
  ADOQuery1.open;
  ADOQuery1.last;
  StringGrid1.Cells[1,6]:=ADOQuery1.Fields[0].asstring;

  StringGrid1.Cells[0,1]:='Mes.Id';
  StringGrid1.Cells[0,2]:='MesCel.Id';
  StringGrid1.Cells[0,3]:='MesRfc.Id';
  StringGrid1.Cells[0,4]:='MesMde.Id';
  StringGrid1.Cells[0,5]:='MesFlt.Id';
  StringGrid1.Cells[0,6]:='MesTbf.Id';
  StringGrid1.Cells[1,0]:=Edit1.text;

  ADOQuery1.close;
  query1.Close;
end;

procedure TForm1.Button6Click(Sender: TObject);
begin
  ProgressBar1.Position:=50;
  Button3.click;
  ProgressBar1.Position:=80;
  Button4.click;
  ProgressBar1.Position:=90;
  Button5.click;
  ProgressBar1.Position:=0;
  Button7.click;
end;

procedure TForm1.Button1Click(Sender: TObject);
var
  id,i:integer;
  CSerN,RsMxp:STRING;
begin
  ProgressBar1.Position:=0;

  ADOQuery1.close;                                                                  //Mes
  ADOQuery1.SQL.Clear;
  ADOQuery1.SQL.add('select Mes.Id, MdeId, CelId, RfcId, FltId, TbfId, ResId, Mid, SerN, Nbm, Mes.Nfl, Stp, Spare, DtCr,MesRes.RsMxp');                    //找出 SQL server 最後ㄧ筆 Mes.ID
  ADOQuery1.sql.add('from Mes,MesRes');
  ADOQuery1.sql.add('Where Mes.Id >:Id1');
  ADOQuery1.sql.add('and Mes.StId=:StId');                                         // 2010.4.15 增加simulator Id
  ADOQuery1.sql.add('and Mes.StId=MesRes.StId');
  ADOQuery1.sql.add('and Mes.Id=MesRes.Id');
  ADOQuery1.sql.add('and Mes.OK=:ok');
  ADOQuery1.sql.add('order by Mes.Id');
  ADOQuery1.Parameters.parambyname('StId').VALUE:=a[7];
  ADOQuery1.Parameters.parambyname('Id1').VALUE:=a[1];
//  ADOQuery1.Parameters.parambyname('Id1').VALUE:=98874;
  ADOQuery1.Parameters.parambyname('ok').VALUE:=1;
  ADOQuery1.open;

  ProgressBar1.max:=ADOQuery1.recordcount;
  i:=0;
  if ADOQuery1.recordcount > 0 then
   begin
     while not ADOQuery1.EOF do
       begin
         RsMxp:=FloattoStr(ADOQuery1.Fields[14].value*100);                          // 生耀客戶序號
         CSerN:='26'+copy(ADOQuery1.Fields[8].value,4,4)+copy(ADOQuery1.Fields[8].value,10,2)+'0'+copy(ADOQuery1.Fields[8].value,14,3)+copy(RsMxp,1,5)+'X';

         Edit3.text:=CSerN;
         Edit2.text:=ADOQuery1.Fields[8].value;

         ADOQuery2.close;
         ADOQuery2.SQL.Clear;
         ADOQuery2.SQL.add('update Mes set CSerN=:CSerN');
         ADOQuery2.SQL.add('where Mes.Id=:Id');
         ADOQuery2.Parameters.ParamByName('Id').Value:=ADOQuery1.Fields[0].value;
         ADOQuery2.Parameters.ParamByName('CSerN').Value:=CSerN;                                // 2010.11.22 增加CSerN
//         ADOQuery2.ExecSQL;

         i:=i+1;
         ProgressBar1.Position:=i;
         ADOQuery1.next;
       end;
      showmessage('CSerN UPDATE ok')
    end;
end;

procedure TForm1.Button2Click(Sender: TObject);
begin
  ADOQuery2.close;
  ADOQuery2.SQL.Clear;
  ADOQuery2.SQL.add('update Mes set CSerN=:CSerN');
  ADOQuery2.SQL.add('where Mes.SerN=:SerN');
  ADOQuery2.SQL.add('and OK=:OK');
  ADOQuery2.Parameters.ParamByName('SerN').Value:=Edit2.text;
  ADOQuery2.Parameters.ParamByName('CSerN').Value:=Edit3.text;                                // 2010.11.26 手動更新CSerN
  ADOQuery2.Parameters.ParamByName('OK').Value:=1;
  ADOQuery2.ExecSQL;
end;

procedure TForm1.Button3Click(Sender: TObject);
var
  id,i:integer;
  CSerN,RsMxp:STRING;
begin
  Label1.Caption:='db copying ........';

  ADOQuery1.close;                                                               //Mes
  ADOQuery1.SQL.Clear;
  ADOQuery1.SQL.add('select Id');                                                //找出 SQL server 最後ㄧ筆 Mes.ID
  ADOQuery1.sql.add('from Mes');
  ADOQuery1.sql.add('Where Id >=:Id');
  ADOQuery1.sql.add('and StId=:StId');                                           // 2010.4.15 增加simulator Id
  ADOQuery1.sql.add('order by Id');
  ADOQuery1.Parameters.parambyname('StId').VALUE:=a[7];
  ADOQuery1.Parameters.parambyname('Id').VALUE:= a[1];
  ADOQuery1.open;
  ADOQuery1.last;
  id:=0;
  if ADOQuery1.RecordCount>0 then id:=ADOQuery1.Fields[0].value;
  ADOQuery1.close;

  query1.close;
  query1.SQL.Clear;                                                              //找出 access > sql 最後ㄧ筆 Mes.ID 的所有記錄
  query1.SQL.add('select Mes.Id, MdeId, CelId, RfcId, FltId, TbfId, ResId, Mid, SerN, Nbm, Mes.Nfl, Stp, Spare, DtCr,RsMxp');
  query1.sql.add('from Mes,MesRes');
  query1.sql.add('where Mes.Id >:id');
  query1.sql.add('and Mes.Id=MesRes.Id');
  query1.sql.add('order by DtCr');                                               //2010.8.20 改用時間排序 修正同序號連續測時不ㄧ定秀出最後1筆
  query1.parambyname('id').asinteger:=id-a[1];                                   
  query1.open;
  query1.first;

  if query1.recordcount > 0 then
    begin
      while not query1.EOF do
        begin
          ADOQuery2.close;
          ADOQuery2.SQL.Clear;
          ADOQuery2.SQL.add('update Mes set OK=0');                               //將已有相同序號資料 OK欄位歸0
          ADOQuery2.sql.add('Where SerN=:srn1');
          ADOQuery2.Parameters.parambyname('srn1').VALUE:= query1.Fields[8].value;
          ADOQuery2.ExecSQL;
          RsMxp:=FloattoStr(query1.Fields[14].value);
          CSerN:='';                                                              // 2010.11.22 增加CSerN 計算
          if RadioGroup1.ItemIndex= 1 then CSerN:='26'+copy(query1.Fields[8].value,4,4)+copy(query1.Fields[8].value,10,2)+'0'+copy(query1.Fields[8].value,14,3)+copy(RsMxp,1,3)+copy(RsMxp,5,2)+'X';    // 2010.11.22 增加CSerN
          if RadioGroup1.ItemIndex= 2 then CSerN:=Edit3.Text;
          ADOQuery2.close;
          ADOQuery2.SQL.Clear;
          ADOQuery2.SQL.add('insert into Mes (Id, MdeId, CelId, RfcId, FltId, TbfId, ResId, Mid, SerN, Nbm, Nfl, Stp, Spare, DtCr, OK, StId, CSerN)');
          ADOQuery2.sql.add('values (:Id, :MdeId, :CelId, :RfcId, :FltId, :TbfId, :ResId, :Mid, :SerN, :Nbm, :Nfl, :Stp, :Spare, :DtCr, :OK, :StId, :CSerN) ');
          ADOQuery2.Parameters.ParamByName('Id').Value:= query1.FieldByName('Id').value+a[1];             //2010.11.30 改成  ParamByName()
          ADOQuery2.Parameters.ParamByName('MdeId').Value:= query1.FieldByName('MdeId').value+a[4];
          ADOQuery2.Parameters.ParamByName('CelId').Value:= query1.FieldByName('CelId').value+a[2];
          ADOQuery2.Parameters.ParamByName('RfcId').Value:= query1.FieldByName('RfcId').value+a[3];
          ADOQuery2.Parameters.ParamByName('FltId').Value:= query1.FieldByName('FltId').value+a[5];
          ADOQuery2.Parameters.ParamByName('TbfId').Value:= query1.FieldByName('TbfId').value+a[6];
          ADOQuery2.Parameters.ParamByName('ResId').Value:= query1.FieldByName('ResId').value+a[1];
          ADOQuery2.Parameters.ParamByName('Mid').Value:= query1.FieldByName('Mid').value;
          ADOQuery2.Parameters.ParamByName('SerN').Value:= query1.FieldByName('SerN').value;
          ADOQuery2.Parameters.ParamByName('Nbm').Value:= query1.FieldByName('Nbm').value;
          ADOQuery2.Parameters.ParamByName('Nfl').Value:= query1.FieldByName('Nfl').value;
          ADOQuery2.Parameters.ParamByName('Stp').Value:= query1.FieldByName('Stp').value;
          ADOQuery2.Parameters.ParamByName('Spare').Value:= query1.FieldByName('Spare').value;
          ADOQuery2.Parameters.ParamByName('DtCr').Value:= query1.FieldByName('DtCr').value;
          ADOQuery2.Parameters.ParamByName('OK').Value:= 1;
          ADOQuery2.Parameters.ParamByName('StId').Value:=a[7];                 // 2010.4.15 增加simulator Id
          ADOQuery2.Parameters.ParamByName('CSerN').Value:=CSerN;               // 2010.11.22 增加CSerN
          ADOQuery2.ExecSQL;
          query1.next;
        end;
//      showmessage('Mes copy ok')
    end;

  ADOQuery1.close;                                                                //MesRes
  ADOQuery1.SQL.Clear;
  ADOQuery1.SQL.add('select Id');
  ADOQuery1.sql.add('from MesRes');
  ADOQuery1.sql.add('Where Id >=:Id');
  ADOQuery1.sql.add('and StId=:StId');                                            // 2010.4.15 增加simulator Id
  ADOQuery1.sql.add('order by Id');
  ADOQuery1.Parameters.parambyname('StId').VALUE:=a[7];
  ADOQuery1.Parameters.parambyname('Id').VALUE:= a[1];
  ADOQuery1.open;
  ADOQuery1.last;
  id:=0;
  if ADOQuery1.RecordCount>0 then   id:=ADOQuery1.Fields[0].value;                //找出 SQL server 最後ㄧ筆 MesRes.ID
  ADOQuery1.close;

  query1.close;
  query1.SQL.Clear;
  query1.SQL.add('select *');                                                      //找出 access > sql 最後ㄧ筆 MesRes.ID 的所有記錄
  query1.sql.add('from MesRes');
  query1.sql.add('where Id >:id');
  query1.parambyname('id').asinteger:=id-a[1];
  query1.open;
  query1.first;

  if query1.recordcount > 0 then
    begin
      while not query1.EOF do
        begin
          ADOQuery2.close;
          ADOQuery2.SQL.Clear;
          ADOQuery2.SQL.add('insert into MesRes (Id,Cli,Irm,Idv,VocStd,IscStd,RsrStd,RshStd,VocVoc,RsrVoc,IscIsc,RshIsc,RsrRsr,RshRsh,Rsd,Nfl,RsVoc,RsIsc,RsUisc,RsMxp,RsMxe,RsEff,RsVpm,RsIpm,RsIav1,RsPav1,RsIav2,RsPav2,RsRsr,RsRsh,RsCcf,RsVcf,RsKcf,StId)');
          ADOQuery2.sql.add('values (:Id,:Cli,:Irm,:Idv,:VocStd,:IscStd,:RsrStd,:RshStd,:VocVoc,:RsrVoc,:IscIsc,:RshIsc,:RsrRsr,:RshRsh,:Rsd,:Nfl,:RsVoc,:RsIsc,:RsUisc,:RsMxp,:RsMxe,:RsEff,:RsVpm,:RsIpm,:RsIav1,:RsPav1,:RsIav2,:RsPav2,:RsRsr,:RsRsh,:RsCcf,:RsVcf,:RsKcf,:StId) ');
          ADOQuery2.Parameters.ParamByName('Id').Value:= query1.FieldByName('Id').value+a[1];        //2010.11.30 改成  FieldByName()
          ADOQuery2.Parameters.ParamByName('Cli').Value:= query1.FieldByName('Cli').value;
          ADOQuery2.Parameters.ParamByName('Irm').Value:= query1.FieldByName('Irm').value;
          ADOQuery2.Parameters.ParamByName('Idv').Value:= query1.FieldByName('Idv').value;
          ADOQuery2.Parameters.ParamByName('VocStd').Value:= query1.FieldByName('VocStd').value;
          ADOQuery2.Parameters.ParamByName('IscStd').Value:= query1.FieldByName('IscStd').value;
          ADOQuery2.Parameters.ParamByName('RsrStd').Value:= query1.FieldByName('RsrStd').value;
          ADOQuery2.Parameters.ParamByName('RshStd').Value:= query1.FieldByName('RshStd').value;
          ADOQuery2.Parameters.ParamByName('VocVoc').Value:= query1.FieldByName('VocVoc').value;
          ADOQuery2.Parameters.ParamByName('RsrVoc').Value:= query1.FieldByName('RsrVoc').value;
          ADOQuery2.Parameters.ParamByName('IscIsc').Value:= query1.FieldByName('IscIsc').value;
          ADOQuery2.Parameters.ParamByName('RshIsc').Value:= query1.FieldByName('RshIsc').value;
          ADOQuery2.Parameters.ParamByName('RsrRsr').Value:= query1.FieldByName('RsrRsr').value;
          ADOQuery2.Parameters.ParamByName('RshRsh').Value:= query1.FieldByName('RshRsh').value;
          ADOQuery2.Parameters.ParamByName('Rsd').Value:= query1.FieldByName('Rsd').value;
          ADOQuery2.Parameters.ParamByName('Nfl').Value:= query1.FieldByName('Nfl').value;
          ADOQuery2.Parameters.ParamByName('RsVoc').Value:= query1.FieldByName('RsVoc').value;
          ADOQuery2.Parameters.ParamByName('RsIsc').Value:= query1.FieldByName('RsIsc').value;
          ADOQuery2.Parameters.ParamByName('RsUisc').Value:= query1.FieldByName('RsUisc').value;
          ADOQuery2.Parameters.ParamByName('RsMxp').Value:= query1.FieldByName('RsMxp').value;
          ADOQuery2.Parameters.ParamByName('RsMxe').Value:= query1.FieldByName('RsMxe').value;
          ADOQuery2.Parameters.ParamByName('RsEff').Value:= query1.FieldByName('RsEff').value;
          ADOQuery2.Parameters.ParamByName('RsVpm').Value:= query1.FieldByName('RsVpm').value;
          ADOQuery2.Parameters.ParamByName('RsIpm').Value:= query1.FieldByName('RsIpm').value;
          ADOQuery2.Parameters.ParamByName('RsIav1').Value:= query1.FieldByName('RsIav1').value;
          ADOQuery2.Parameters.ParamByName('RsPav1').Value:= query1.FieldByName('RsPav1').value;
          ADOQuery2.Parameters.ParamByName('RsIav2').Value:= query1.FieldByName('RsIav2').value;
          ADOQuery2.Parameters.ParamByName('RsPav2').Value:= query1.FieldByName('RsPav2').value;
          ADOQuery2.Parameters.ParamByName('RsRsr').Value:= query1.FieldByName('RsRsr').value;
          ADOQuery2.Parameters.ParamByName('RsRsh').Value:= query1.FieldByName('RsRsh').value;
          ADOQuery2.Parameters.ParamByName('RsCcf').Value:= query1.FieldByName('RsCcf').value;
          ADOQuery2.Parameters.ParamByName('RsVcf').Value:= query1.FieldByName('RsVcf').value;
          ADOQuery2.Parameters.ParamByName('RsKcf').Value:= query1.FieldByName('RsKcf').value;
          ADOQuery2.Parameters.ParamByName('StId').Value:=a[7];                 // 2010.4.15 增加simulator Id
          ADOQuery2.ExecSQL;
          query1.next;
        end;
//      showmessage('MesRes copy ok')
    end;

  ADOQuery1.close;                                                              //MesT
  ADOQuery1.SQL.Clear;
  ADOQuery1.SQL.add('select MesId');
  ADOQuery1.sql.add('from MesT');
  ADOQuery1.sql.add('Where MesId >=:MesId');
  ADOQuery1.sql.add('and StId=:StId');                                          // 2010.4.15 增加simulator Id
  ADOQuery1.sql.add('order by MesId');
  ADOQuery1.Parameters.parambyname('StId').VALUE:=a[7];
  ADOQuery1.Parameters.parambyname('MesId').VALUE:=a[1];
  ADOQuery1.open;
  ADOQuery1.last;
  id:=0;
  if ADOQuery1.RecordCount>0 then   id:=ADOQuery1.Fields[0].value;
  ADOQuery1.close;

  query1.close;
  query1.SQL.Clear;
  query1.SQL.add('select *');
  query1.sql.add('from MesT');
  query1.sql.add('where MesId >:id');
//  query1.sql.add('and MesTypId =:MesTypId');                                    //2010.12.15 V2.44  MesTypId=9
  query1.parambyname('id').asinteger:=id-a[1];
//  query1.parambyname('MesTypId').asinteger:=9;
  query1.open;
  query1.first;

  if query1.recordcount > 0 then
    begin
      while not query1.EOF do
        begin
          ADOQuery2.close;
          ADOQuery2.SQL.Clear;
          ADOQuery2.SQL.add('insert into MesT (MesId, MesTypId, T1, T4, StId)');
          ADOQuery2.sql.add('values (:MesId, :MesTypId, :T1, :T4, :StId) ');
          ADOQuery2.Parameters.ParamByName('MesId').Value:= query1.FieldByName('MesId').value+a[1];             //2010.11.30 改成  FieldByName()
          ADOQuery2.Parameters.ParamByName('MesTypId').Value:= query1.FieldByName('MesTypId').value;
          ADOQuery2.Parameters.ParamByName('T1').Value:= query1.FieldByName('T1').value;
          ADOQuery2.Parameters.ParamByName('T4').Value:= query1.FieldByName('T4').value;
          ADOQuery2.Parameters.ParamByName('StId').value:=a[7];                                // 2010.4.15 增加simulator Id
          ADOQuery2.ExecSQL;
          query1.next;
        end;
//      showmessage('MesT copy ok')
    end;

  ADOQuery1.close;                                                                //MesCel
  ADOQuery1.SQL.Clear;
  ADOQuery1.SQL.add('select Id');
  ADOQuery1.sql.add('from MesCel');
  ADOQuery1.sql.add('where StId=:StId');                                           // 2010.4.15 增加simulator Id
  ADOQuery1.sql.add('and Id >=:Id');
  ADOQuery1.sql.add('order by Id');
  ADOQuery1.Parameters.parambyname('StId').VALUE:=a[7];
  ADOQuery1.Parameters.parambyname('Id').VALUE:= a[2];
  ADOQuery1.open;
  ADOQuery1.last;
  id:=0;
  if ADOQuery1.RecordCount>0 then id:=ADOQuery1.Fields[0].value;
  ADOQuery1.close;

  query1.close;
  query1.SQL.Clear;
  query1.SQL.add('select *');
  query1.sql.add('from MesCel');
  query1.sql.add('where Id >:id');
  query1.sql.add('order by Id ');
  query1.parambyname('id').asinteger:=id-a[2];
  query1.open;
  query1.first;

  if query1.recordcount > 0 then
    begin
      while not query1.EOF do
        begin
          ADOQuery2.close;
          ADOQuery2.SQL.Clear;
//          ADOQuery2.SQL.add('insert into MesCel(Id,Dcel,CelT,MdId,Surf,Srfm,Ncs,Ncp,MaxV,MaxI,MinVs,MaxVs,MaxIs,V1Rsh,V2Rsh,ImxRsh,TcRsh,Vscm,DlTrg,T1,Ccf,Vcf,Kcf,Fcu,Fci,Fcp,RfIrr,Vrf1,Vrf2,Snmd,Fgm,PnTyp,RfPnl,LstTstDte,CurTstCnt,NxtTstDte,NxtTstCnt,VscFcP,VscFcN,IsvFcP,IsvFcN,Spare,DtCr,DtMd,Visa,Obs,StId)');
//          ADOQuery2.sql.add('values(:Id,:Dcel,:CelT,:MdId,:Surf,:Srfm,:Ncs,:Ncp,:MaxV,:MaxI,:MinVs,:MaxVs,:MaxIs,:V1Rsh,:V2Rsh,:ImxRsh,:TcRsh,:Vscm,:DlTrg,:T1,:Ccf,:Vcf,:Kcf,:Fcu,:Fci,:Fcp,:RfIrr,:Vrf1,:Vrf2,:Snmd,:Fgm,:PnTyp,:RfPnl,:LstTstDte,:CurTstCnt,:NxtTstDte,:NxtTstCnt,:VscFcP,:VscFcN,:IsvFcP,:IsvFcN,:Spare,:DtCr,:DtMd,:Visa,:Obs,:StId)');
          ADOQuery2.SQL.add('insert into MesCel(Id,Dcel,CelT,MdId,Surf,Srfm,Ncs,Ncp,MaxV,MaxI,MinVs,MaxVs,MaxIs,V1Rsh,V2Rsh,ImxRsh,TcRsh,Vscm,DlTrg,T1,Ccf,Vcf,Kcf,Fcu,Fci,Fcp,RfIrr,Vrf1,Vrf2,Snmd,Fgm,PnTyp,RfPnl,StId)');
          ADOQuery2.sql.add('values(:Id,:Dcel,:CelT,:MdId,:Surf,:Srfm,:Ncs,:Ncp,:MaxV,:MaxI,:MinVs,:MaxVs,:MaxIs,:V1Rsh,:V2Rsh,:ImxRsh,:TcRsh,:Vscm,:DlTrg,:T1,:Ccf,:Vcf,:Kcf,:Fcu,:Fci,:Fcp,:RfIrr,:Vrf1,:Vrf2,:Snmd,:Fgm,:PnTyp,:RfPnl,:StId)');
          ADOQuery2.Parameters.ParamByName('Id').Value:=query1.FieldByName('Id').value+a[2];     // 2010.12.01 改用 FieldByName
          ADOQuery2.Parameters.ParamByName('Dcel').value:=query1.FieldByName('Dcel').value;
          ADOQuery2.Parameters.ParamByName('CelT').value:=query1.FieldByName('CelT').value;
          ADOQuery2.Parameters.ParamByName('MdId').value:=query1.FieldByName('MdId').value;
          ADOQuery2.Parameters.ParamByName('Surf').value:=query1.FieldByName('Surf').value;
          ADOQuery2.Parameters.ParamByName('Srfm').value:=query1.FieldByName('Srfm').value;
          ADOQuery2.Parameters.ParamByName('Ncs').value:=query1.FieldByName('Ncs').value;
          ADOQuery2.Parameters.ParamByName('Ncp').value:=query1.FieldByName('Ncp').value;
          ADOQuery2.Parameters.ParamByName('MaxV').value:=query1.FieldByName('MaxV').value;
          ADOQuery2.Parameters.ParamByName('MaxI').value:=query1.FieldByName('MaxI').value;
          ADOQuery2.Parameters.ParamByName('MinVs').value:=query1.FieldByName('MinVs').value;
          ADOQuery2.Parameters.ParamByName('MaxVs').value:=query1.FieldByName('MaxVs').value;
          ADOQuery2.Parameters.ParamByName('MaxIs').value:=query1.FieldByName('MaxIs').value;
          ADOQuery2.Parameters.ParamByName('V1Rsh').value:=query1.FieldByName('V1Rsh').value;
          ADOQuery2.Parameters.ParamByName('V2Rsh').value:=query1.FieldByName('V2Rsh').value;
          ADOQuery2.Parameters.ParamByName('ImxRsh').value:=query1.FieldByName('ImxRsh').value;
          ADOQuery2.Parameters.ParamByName('TcRsh').value:=query1.FieldByName('TcRsh').value;
          ADOQuery2.Parameters.ParamByName('Vscm').value:=query1.FieldByName('Vscm').value;
          ADOQuery2.Parameters.ParamByName('DlTrg').value:=query1.FieldByName('DlTrg').value;
          ADOQuery2.Parameters.ParamByName('T1').value:=query1.FieldByName('T1').value;
          ADOQuery2.Parameters.ParamByName('Ccf').value:=query1.FieldByName('Ccf').value;
          ADOQuery2.Parameters.ParamByName('Vcf').value:=query1.FieldByName('Vcf').value;
          ADOQuery2.Parameters.ParamByName('Kcf').value:=query1.FieldByName('Kcf').value;
          ADOQuery2.Parameters.ParamByName('Fcu').value:=query1.FieldByName('Fcu').value;
          ADOQuery2.Parameters.ParamByName('Fci').value:=query1.FieldByName('Fci').value;
          ADOQuery2.Parameters.ParamByName('Fcp').value:=query1.FieldByName('Fcp').value;
          ADOQuery2.Parameters.ParamByName('RfIrr').value:=query1.FieldByName('RfIrr').value;
          ADOQuery2.Parameters.ParamByName('Vrf1').value:=query1.FieldByName('Vrf1').value;
          ADOQuery2.Parameters.ParamByName('Vrf2').value:=query1.FieldByName('Vrf2').value;
          ADOQuery2.Parameters.ParamByName('Snmd').value:=query1.FieldByName('Snmd').value;
          ADOQuery2.Parameters.ParamByName('Fgm').value:=query1.FieldByName('Fgm').value;
          ADOQuery2.Parameters.ParamByName('PnTyp').value:=query1.FieldByName('PnTyp').value;
          ADOQuery2.Parameters.ParamByName('RfPnl').value:=query1.FieldByName('RfPnl').value;
          ADOQuery2.Parameters.ParamByName('StId').value:=a[7];
          ADOQuery2.ExecSQL;

          ADOQuery2.close;
          ADOQuery2.SQL.Clear;
          ADOQuery2.SQL.add('update MesCel');                                                   // 2010.12.01 寫不下改用 update
          ADOQuery2.SQL.add('set LstTstDte=:LstTstDte,CurTstCnt=:CurTstCnt,NxtTstDte=:NxtTstDte,NxtTstCnt=:NxtTstCnt,VscFcP=:VscFcP,VscFcN=:VscFcN,IsvFcP=:IsvFcP,IsvFcN=:IsvFcN,Spare=:Spare,DtCr=:DtCr,DtMd=:DtMd,Visa=:Visa,Obs=:Obs');  //2011.03.23 修正
          ADOQuery2.sql.add('where Id=:Id');
          ADOQuery2.sql.add('and StId=:StId');
          ADOQuery2.Parameters.ParamByName('Id').Value:=query1.FieldByName('Id').value+a[2];
          ADOQuery2.Parameters.ParamByName('LstTstDte').value:=query1.FieldByName('LstTstDte').value;
          ADOQuery2.Parameters.ParamByName('CurTstCnt').value:=query1.FieldByName('CurTstCnt').value;
          ADOQuery2.Parameters.ParamByName('NxtTstDte').value:=query1.FieldByName('NxtTstDte').value;   //2011.03.23 修正
          ADOQuery2.Parameters.ParamByName('NxtTstCnt').value:=query1.FieldByName('NxtTstCnt').value;
          ADOQuery2.Parameters.ParamByName('VscFcP').value:=query1.FieldByName('VscFcP').value;
          ADOQuery2.Parameters.ParamByName('VscFcN').value:=query1.FieldByName('VscFcN').value;
          ADOQuery2.Parameters.ParamByName('IsvFcP').value:=query1.FieldByName('IsvFcP').value;
          ADOQuery2.Parameters.ParamByName('IsvFcN').value:=query1.FieldByName('IsvFcN').value;
          ADOQuery2.Parameters.ParamByName('Spare').value:=query1.FieldByName('Spare').value;
          ADOQuery2.Parameters.ParamByName('DtCr').value:=query1.FieldByName('DtCr').value;
          ADOQuery2.Parameters.ParamByName('DtMd').value:=query1.FieldByName('DtMd').value;
          ADOQuery2.Parameters.ParamByName('Visa').value:=query1.FieldByName('Visa').value;
          ADOQuery2.Parameters.ParamByName('Obs').value:=query1.FieldByName('Obs').value;
          ADOQuery2.Parameters.ParamByName('StId').value:=a[7];                     //2011.03.23 修正
          ADOQuery2.ExecSQL;

          query1.next;
        end;
//      showmessage('MesCel copy ok')
    end;
    Label1.Caption:='db copy ok!';
end;

procedure TForm1.Button5Click(Sender: TObject);
var
  id,i:integer;
begin

  Label1.Caption:='db copying ........';

  ADOQuery1.close;                                                               //MesResPts
  ADOQuery1.SQL.Clear;
  ADOQuery1.SQL.add('select MesId');
  ADOQuery1.sql.add('from MesResPts');
  ADOQuery1.sql.add('where Id=1');
  ADOQuery1.sql.add('and StId=:StId');                                           // 2010.4.15 增加simulator Id
  ADOQuery1.sql.add('and MesId>=:Id');
  ADOQuery1.sql.add('order by MesId');
  ADOQuery1.Parameters.parambyname('StId').VALUE:=a[7];
  ADOQuery1.Parameters.parambyname('Id').VALUE:= a[1];
  ADOQuery1.open;
  ADOQuery1.last;
  id:=0;
  if ADOQuery1.RecordCount>0 then id:=ADOQuery1.Fields[0].value;
  ADOQuery1.close;

  query1.close;
  query1.SQL.Clear;
  query1.SQL.add('select *');
  query1.sql.add('from MesResPts');
  query1.sql.add('where MesId >:id');
  query1.parambyname('id').asinteger:=id-a[1];
  query1.open;
  query1.first;
  ProgressBar1.Position:=0;
  ProgressBar1.Max:=query1.recordcount;

  if query1.recordcount > 0 then
    begin
      while not query1.EOF do
        begin
          ADOQuery2.close;
          ADOQuery2.SQL.Clear;
          ADOQuery2.SQL.add('insert into MesResPts (Id, MesId, SubMesId, Cv, Cc, Cp, StId)');
          ADOQuery2.sql.add('values (:Id, :MesId, :SubMesId, :Cv, :Cc, :Cp, :StId) ');
          ADOQuery2.Parameters.ParamByName('Id').Value:= query1.FieldByName('Id').value;       //2010.11.30 改成  ParamByName()
          ADOQuery2.Parameters.ParamByName('MesId').Value:= query1.FieldByName('MesId').value+a[1];
          ADOQuery2.Parameters.ParamByName('SubMesId').Value:= query1.FieldByName('SubMesId').value;
          ADOQuery2.Parameters.ParamByName('Cv').Value:= query1.FieldByName('Cv').value;       // V2.12 增加欄位
          ADOQuery2.Parameters.ParamByName('Cc').Value:= query1.FieldByName('Cc').value;
          ADOQuery2.Parameters.ParamByName('Cp').Value:= query1.FieldByName('Cp').value;
          ADOQuery2.Parameters.ParamByName('StId').Value:=a[7];
          ADOQuery2.ExecSQL;
          i:=i+1;
          ProgressBar1.Position:=i;
          query1.next;
        end;
//      showmessage('MesResPts copy ok')
    end;
    ProgressBar1.Position:=0;
    Label1.Caption:='db copy ok!';  
end;

procedure TForm1.Button4Click(Sender: TObject);
var
  id,i:integer;
begin

  Label1.Caption:='db copying ........';

  ADOQuery1.close;                                                                //MesCelCcl
  ADOQuery1.SQL.Clear;
  ADOQuery1.SQL.add('select CelId');
  ADOQuery1.sql.add('from MesCelCcl');
  ADOQuery1.sql.add('where StId=:StId');                                          // 2010.4.15 增加simulator Id
  ADOQuery1.sql.add('order by CelId');
  ADOQuery1.Parameters.parambyname('StId').VALUE:=a[7];
  ADOQuery1.open;
  ADOQuery1.last;
  id:=0;
  if ADOQuery1.RecordCount>0 then  id:=ADOQuery1.Fields[0].value;
  ADOQuery1.close;

  query1.close;
  query1.SQL.Clear;
  query1.SQL.add('select *');
  query1.sql.add('from MesCelCcl');
  query1.sql.add('where CelId >:id');
  query1.parambyname('id').asinteger:=id-a[2];
  query1.open;
  query1.first;

  if query1.recordcount > 0 then
    begin
      ADOTMesCelCcl.active:=true;
      ADOTMesCelCcl.last;
      while not query1.EOF do
        begin
          ADOTMesCelCcl.Append;
          ADOTMesCelCcl.FieldByName('Id').value:=query1.FieldByName('Id').value;          // 2010.12.01 改用 FieldByName
          ADOTMesCelCcl.FieldByName('CelId').value:=query1.FieldByName('CelId').value+a[2];
          ADOTMesCelCcl.FieldByName('Lbl').value:=query1.FieldByName('Lbl').value;
          ADOTMesCelCcl.FieldByName('ClTyp').value:=query1.FieldByName('ClTyp').value;
          ADOTMesCelCcl.FieldByName('ClOut').value:=query1.FieldByName('ClOut').value;
          ADOTMesCelCcl.FieldByName('StId').value:=a[7];
          query1.next;
        end;
      ADOTMesCelCcl.Post;
      ADOTMesCelCcl.active:=false;
//      showmessage('MesCelCcl copy ok')
    end;

  ProgressBar1.Position:=10;
  ADOQuery1.close;                                                                 //MesCelCcr
  ADOQuery1.SQL.Clear;
  ADOQuery1.SQL.add('select CelId');
  ADOQuery1.sql.add('from MesCelCcr');
  ADOQuery1.sql.add('where StId=:StId');                                          // 2010.4.15 增加simulator Id
  ADOQuery1.sql.add('order by CelId');
  ADOQuery1.Parameters.parambyname('StId').VALUE:=a[7];
  ADOQuery1.open;
  ADOQuery1.last;
  id:=0;
  if ADOQuery1.RecordCount>0 then id:=ADOQuery1.Fields[0].value;
  ADOQuery1.close;

  query1.close;
  query1.SQL.Clear;
  query1.SQL.add('select *');
  query1.sql.add('from MesCelCcr');
  query1.sql.add('where CelId >:id');
  query1.parambyname('id').asinteger:=id-a[2];
  query1.open;
  query1.first;

  if query1.recordcount > 0 then
    begin
      ADOTMesCelCcr.active:=true;
      ADOTMesCelCcr.last;
      while not query1.EOF do
        begin
          ADOTMesCelCcr.Append;
          ADOTMesCelCcr.FieldByName('Id').value:=query1.FieldByName('Id').value;          // 2010.12.01 改用 FieldByName
          ADOTMesCelCcr.FieldByName('CelId').value:=query1.FieldByName('CelId').value+a[2];
          ADOTMesCelCcr.FieldByName('CclId').value:=query1.FieldByName('CclId').value;
          ADOTMesCelCcr.FieldByName('FgOp').value:=query1.FieldByName('FgOp').value;
          ADOTMesCelCcr.FieldByName('Tgt1').value:=query1.FieldByName('Tgt1').value;
          ADOTMesCelCcr.FieldByName('Tgt2').value:=query1.FieldByName('Tgt2').value;
          ADOTMesCelCcr.FieldByName('StId').value:=a[7];
          query1.next;
        end;
      ADOTMesCelCcr.Post;
      ADOTMesCelCcr.active:=false;
//      showmessage('MesCelCcr copy ok')
    end;

  ProgressBar1.Position:=15;
  ADOQuery1.close;                                                                //MesRfc
  ADOQuery1.SQL.Clear;
  ADOQuery1.SQL.add('select Id');
  ADOQuery1.sql.add('from MesRfc');
  ADOQuery1.sql.add('where StId=:StId');                                          // 2010.4.15 增加simulator Id
  ADOQuery1.sql.add('order by Id');
  ADOQuery1.Parameters.parambyname('StId').VALUE:=a[7];
  ADOQuery1.open;
  ADOQuery1.last;
  id:=0;
  if ADOQuery1.RecordCount>0 then id:=ADOQuery1.Fields[0].value;
  ADOQuery1.close;

  query1.close;
  query1.SQL.Clear;
  query1.SQL.add('select *');
  query1.sql.add('from MesRfc');
  query1.sql.add('where Id >:id');
  query1.parambyname('id').asinteger:=id-a[3];
  query1.open;
  query1.first;

  if query1.recordcount > 0 then
    begin
      ADOTRfc.active:=true;
      ADOTRfc.last;
      while not query1.EOF do
        begin
          ADOTRfc.Append;
          ADOTRfc.FieldByName('Id').value:=query1.FieldByName('Id').value+a[3];          // 2010.12.01 改用 FieldByName
          ADOTRfc.FieldByName('Rct').value:=query1.FieldByName('Rct').value;
          ADOTRfc.FieldByName('Rcn').value:=query1.FieldByName('Rcn').value;
          ADOTRfc.FieldByName('Rcs').value:=query1.FieldByName('Rcs').value;
          ADOTRfc.FieldByName('Rvcf').value:=query1.FieldByName('Rvcf').value;
          ADOTRfc.FieldByName('Spare').value:=query1.FieldByName('Spare').value;
          ADOTRfc.FieldByName('DtCr').value:=query1.FieldByName('DtCr').value;
          ADOTRfc.FieldByName('DtMd').value:=query1.FieldByName('DtMd').value;
          ADOTRfc.FieldByName('Visa').value:=query1.FieldByName('Visa').value;
          ADOTRfc.FieldByName('StId').value:=a[7];
          query1.next;
        end;
      ADOTRfc.Post;
      ADOTRfc.active:=false;
//      showmessage('MesRfc copy ok')
    end;
  ProgressBar1.Position:=20;
  ADOQuery1.close;                                                                  //MesFlt
  ADOQuery1.SQL.Clear;
  ADOQuery1.SQL.add('select Id');
  ADOQuery1.sql.add('from MesFlt');
  ADOQuery1.sql.add('where StId=:StId');                                           // 2010.4.15 增加simulator Id
  ADOQuery1.sql.add('order by Id');
  ADOQuery1.Parameters.parambyname('StId').VALUE:=a[7];
  ADOQuery1.open;
  ADOQuery1.last;
  id:=0;
  if ADOQuery1.RecordCount>0 then   id:=ADOQuery1.Fields[0].value;
  ADOQuery1.close;

  query1.close;
  query1.SQL.Clear;
  query1.SQL.add('select *');
  query1.sql.add('from MesFlt');
  query1.sql.add('where Id >:id');
  query1.parambyname('id').asinteger:=id-a[5];
  query1.open;
  query1.first;

  if query1.recordcount > 0 then
    begin
      ADOTMesFlt.active:=true;
      ADOTMesFlt.last;
      while not query1.EOF do
        begin
          ADOTMesFlt.Append;
          ADOTMesFlt.FieldByName('Id').value:=query1.FieldByName('Id').value+a[5];          // 2010.12.01 改用 FieldByName
          ADOTMesFlt.FieldByName('Lbl').value:=query1.FieldByName('Lbl').value;
          ADOTMesFlt.FieldByName('Attn').value:=query1.FieldByName('Attn').value;
          ADOTMesFlt.FieldByName('Spare').value:=query1.FieldByName('Spare').value;
          ADOTMesFlt.FieldByName('DtCr').value:=query1.FieldByName('DtCr').value;
          ADOTMesFlt.FieldByName('DtMd').value:=query1.FieldByName('DtMd').value;
          ADOTMesFlt.FieldByName('Visa').value:=query1.FieldByName('Visa').value;
          ADOTMesFlt.FieldByName('StId').value:=a[7];
          query1.next;
        end;
      ADOTMesFlt.Post;
      ADOTMesFlt.active:=false;
//      showmessage('MesFlt copy ok')
    end;

  ProgressBar1.Position:=25;
  ADOQuery1.close;                                                                //MesMde
  ADOQuery1.SQL.Clear;
  ADOQuery1.SQL.add('select Id');
  ADOQuery1.sql.add('from MesMde');
  ADOQuery1.sql.add('where StId=:StId');                                         // 2010.4.15 增加simulator Id
  ADOQuery1.sql.add('order by Id');
  ADOQuery1.Parameters.parambyname('StId').VALUE:=a[7];
  ADOQuery1.open;
  ADOQuery1.last;
  id:=0;
  if ADOQuery1.RecordCount>0 then   id:=ADOQuery1.Fields[0].value;
  ADOQuery1.close;

  query1.close;
  query1.SQL.Clear;
  query1.SQL.add('select *');
  query1.sql.add('from MesMde');
  query1.sql.add('where Id >:id');
  query1.parambyname('id').asinteger:=id-a[4];
  query1.open;
  query1.first;

  if query1.recordcount > 0 then
    begin
      ADOTMesMde.active:=true;
      ADOTMesMde.last;
      while not query1.EOF do
        begin
          ADOTMesMde.Append;
          ADOTMesMde.FieldByName('Id').value:=query1.FieldByName('Id').value+a[4]; // 2010.12.01 改用 FieldByName
          ADOTMesMde.FieldByName('Nme').value:=query1.FieldByName('Nme').value;
          ADOTMesMde.FieldByName('Dsc').value:=query1.FieldByName('Dsc').value;
          ADOTMesMde.FieldByName('Emd').value:=query1.FieldByName('Emd').value;
          ADOTMesMde.FieldByName('Efg').value:=query1.FieldByName('Efg').value;
          ADOTMesMde.FieldByName('Stp').value:=query1.FieldByName('Stp').value;
          ADOTMesMde.FieldByName('Vms').value:=query1.FieldByName('Vms').value;
          ADOTMesMde.FieldByName('Vini').value:=query1.FieldByName('Vini').value;
          ADOTMesMde.FieldByName('Vter').value:=query1.FieldByName('Vter').value;
          ADOTMesMde.FieldByName('Vinc').value:=query1.FieldByName('Vinc').value;
          ADOTMesMde.FieldByName('Splt').value:=query1.FieldByName('Splt').value;
          ADOTMesMde.FieldByName('Tspc').value:=query1.FieldByName('Tspc').value;
          ADOTMesMde.FieldByName('Isr1').value:=query1.FieldByName('Isr1').value;
          ADOTMesMde.FieldByName('Isr2').value:=query1.FieldByName('Isr2').value;
          ADOTMesMde.FieldByName('T1').value:=query1.FieldByName('T1').value;
          ADOTMesMde.FieldByName('T2').value:=query1.FieldByName('T2').value;
          ADOTMesMde.FieldByName('T3').value:=query1.FieldByName('T3').value;
          ADOTMesMde.FieldByName('T4').value:=query1.FieldByName('T4').value;
          ADOTMesMde.FieldByName('DtCr').value:=query1.FieldByName('DtCr').value;
          ADOTMesMde.FieldByName('DtMd').value:=query1.FieldByName('DtMd').value;
          ADOTMesMde.FieldByName('Visa').value:=query1.FieldByName('Visa').value;
          ADOTMesMde.FieldByName('StId').value:=a[7];                            // 2010.4.15 增加simulator Id
          query1.next;
        end;
      ADOTMesMde.Post;
      ADOTMesMde.active:=false;
//      showmessage('MesMde copy ok')
    end;
{
  ADOQuery1.close;                               //MesSfl
  ADOQuery1.SQL.Clear;
  ADOQuery1.SQL.add('select Id');
  ADOQuery1.sql.add('from MesSfl');
  ADOQuery1.sql.add('order by Id');
  ADOQuery1.open;
  ADOQuery1.last;
  id:=ADOQuery1.Fields[0].value;
  ADOQuery1.close;

  query1.close;
  query1.SQL.Clear;
  query1.SQL.add('select *');
  query1.sql.add('from MesSfl');
  query1.sql.add('where Id >:id');
  query1.parambyname('id').asinteger:=id;
  query1.open;
  query1.first;

  if query1.recordcount > 0 then
    begin
      ADOTMesSfl.active:=true;
      ADOTMesSfl.last;
      while not query1.EOF do
        begin
          ADOTMesSfl.Append;
          ADOTMesSfl.Fields[0].value:=query1.Fields[0].value;
          for i := 1 to 3 do
            ADOTMesSfl.Fields[i].value:=query1.Fields[i].value;
          query1.next;
        end;
      ADOTMesSfl.Post;
      ADOTMesSfl.active:=false;
      showmessage('MesSfl copy ok')
    end;
}
   Label1.Caption:='db copy ok!';
end;

procedure TForm1.Timer1Timer(Sender: TObject);
var
  s:string;
begin
  s:=timetostr(now);
  if (copy(s,1,5)='00:30') or (copy(s,1,5)='03:30') or (copy(s,1,5)='05:30') or      //定時上傳資料
     (copy(s,1,5)='08:30') or (copy(s,1,5)='10:30') or (copy(s,1,5)='12:30') or
     (copy(s,1,5)='15:30') or (copy(s,1,5)='17:30') or (copy(s,1,5)='20:30') or
     (copy(s,1,5)='22:30') then
    begin
//      Button6.Click;
    end;
end;

procedure TForm1.Button7Click(Sender: TObject);
begin
  query1.close;                                                                  // check access Mes 最後一筆資料日期
  query1.SQL.Clear;
  query1.SQL.add('select DtCr');
  query1.sql.add('from Mes');
  query1.sql.add('order by DtCr');
  query1.open;
  query1.last;
  Label7.Caption:=query1.Fields[0].asstring;

  ADOQuery1.close;                                                               //   check SQL Mes 最後一筆資料日期
  ADOQuery1.SQL.Clear;                                                           //   check SQL Mes.Id
  ADOQuery1.SQL.add('select DtCr,Id');
  ADOQuery1.sql.add('from Mes');
  ADOQuery1.sql.add('where StId=:StId');                                         // 2010.4.15 增加simulator Id
  ADOQuery1.sql.add('and Id>=:Id');
  ADOQuery1.sql.add('order by DtCr');
  ADOQuery1.Parameters.parambyname('StId').VALUE:=a[7];
  ADOQuery1.Parameters.parambyname('Id').VALUE:=a[1];
  ADOQuery1.open;
  ADOQuery1.last;
  Label11.Caption:=ADOQuery1.Fields[0].asstring;
  StringGrid1.Cells[1,1]:=ADOQuery1.Fields[1].asstring;
end;

end.
